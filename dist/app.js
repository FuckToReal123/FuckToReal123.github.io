!function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var o={DEFAULT_GAME_FIELD_SIZE:4,DEFAULT_GAME_ITEM_SIZE:100,GAME_ITEM_MOVE_DURATION:400,GAME_FIELD_REFRESH_DURATION:420,MINIMAL_MOUSE_SHIFT:50,GAME_ITEM_HTML_CLASS:"thing",GAME_FIELD_HTML_CLASS:"playfield"},n=function(){var e,t=function(e){var t=document.getElementById(o.GAME_FIELD_HTML_CLASS),i="";setTimeout(function(){for(var n=t.getElementsByClassName(o.GAME_ITEM_HTML_CLASS);n[0];)n[0].parentNode.removeChild(n[0]);e.elements.forEach(function(e){i+='<div class="'+o.GAME_ITEM_HTML_CLASS+" t"+e.value+'" id="'+e.id+'" style="top: '+e.position.vertical+"px; left: "+e.position.horizontal+'px;"></div>'}),t.innerHTML+=i},o.GAME_FIELD_REFRESH_DURATION)},i=function(e){var t=document.getElementById(e.id);$(t).animate({left:e.position.horizontal+"px",top:e.position.vertical+"px"},o.GAME_ITEM_MOVE_DURATION)};return{getInstance:function(){return e||(e={refreshField:t,moveGameItem:i})}}}(),r=0;function l(e,t){this.value=e,this.position={vertical:t.vertical,horizontal:t.horizontal},this.id=r,this.view=n.getInstance(),r+=1}l.prototype.move=function(e){this.position.horizontal=e.horizontal,this.position.vertical=e.vertical;this.view.moveGameItem(this)},l.prototype.setValue=function(e){this.value=e};var a=l,s={randomInt:function(e,t){var i=e+Math.random()*(t+1-e);return i=Math.floor(i)}};function c(e){this.size=e,this.elements=[],this.view=n.getInstance()}c.prototype.refresh=function(){this.view.refreshField(this)},c.prototype.insertElement=function(e){this.elements.push(e)},c.prototype.getRandomFreeCell=function(){for(var e=[],t=o.DEFAULT_GAME_ITEM_SIZE,i=0;i<this.size;i++)for(var n=0;n<this.size;n++){var r={vertical:i*t,horizontal:n*t};this.isCellFree(r)&&e.push(r)}return e[s.randomInt(0,e.length-1)]},c.prototype.isFreeCells=function(){return this.elements.length!==Math.pow(this.size,2)},c.prototype.addElement=function(){this.isFreeCells()&&(Math.random()<.9?this.insertElement(new a(2,this.getRandomFreeCell())):this.insertElement(new a(4,this.getRandomFreeCell())),this.refresh())},c.prototype.isCellFree=function(e){var t=!0;return this.getElementByPosition(e)&&(t=!1),t},c.prototype.getElementByPosition=function(e){return this.elements.find(function(t){return!t.merged&&t.position.vertical==e.vertical&&t.position.horizontal==e.horizontal})};var u=c;function v(e){this.field=new u(e),this.moveVector={x:0,y:0,compareFunc:void 0}}v.prototype.makePositionValid=function(e){var t={vertical:0,horizontal:0};return e.vertical>(this.field.size-1)*o.DEFAULT_GAME_ITEM_SIZE?t.vertical=(this.field.size-1)*o.DEFAULT_GAME_ITEM_SIZE:e.vertical<0?t.vertical=0:t.vertical=e.vertical,e.horizontal>(this.field.size-1)*o.DEFAULT_GAME_ITEM_SIZE?t.horizontal=(this.field.size-1)*o.DEFAULT_GAME_ITEM_SIZE:e.horizontal<0?t.horizontal=0:t.horizontal=e.horizontal,t},v.prototype.isMoveAvalible=function(e){var t=this.makePositionValid(e);return this.field.isCellFree(e)&&e.vertical==t.vertical&&e.horizontal==t.horizontal},v.prototype.moveElements=function(){var e=this,t=e.moveVector.y*o.DEFAULT_GAME_ITEM_SIZE,i=e.moveVector.x*o.DEFAULT_GAME_ITEM_SIZE,n=0;e.field.elements.sort(e.moveVector.compareFunc),e.field.elements.forEach(function(r,l,a){for(var s={vertical:r.position.vertical,horizontal:r.position.horizontal},c={vertical:r.position.vertical+t,horizontal:r.position.horizontal+i};e.isMoveAvalible(c);)n+=1,s.horizontal=c.horizontal,s.vertical=c.vertical,c.vertical+=t,c.horizontal+=i;var u=e.field.getElementByPosition(e.makePositionValid(c));if(u&&r.value==u.value&&r.id!=u.id){u.setValue(2*r.value);var v=0==e.moveVector.y?0:o.DEFAULT_GAME_ITEM_SIZE/2,h=0==e.moveVector.x?0:o.DEFAULT_GAME_ITEM_SIZE/2,E={vertical:e.makePositionValid(c).vertical-v,horizontal:e.makePositionValid(c).horizontal-h};r.move(e.makePositionValid(E)),a[l].merged=!0,n+=1}else r.move(e.makePositionValid(s))}),e.field.elements=e.field.elements.filter(function(e){return!e.merged}),0!==n?e.field.addElement():this.field.isFreeCells()||alert("Game Over!")},v.prototype.init=function(){var e=this,t=0,i=0,n=0,r=0;window.onmousedown=function(e){t=e.clientX,i=e.clientY},window.onmouseup=function(l){n=l.clientX,r=l.clientY,(Math.abs(t-n)>o.MINIMAL_MOUSE_SHIFT||Math.abs(i-r)>o.MINIMAL_MOUSE_SHIFT)&&(e.setMoveVector(t,n,i,r),e.moveElements())},e.field.addElement()},v.prototype.setMoveVector=function(e,t,i,o){Math.abs(t-e)>Math.abs(o-i)?e<t?(this.moveVector.x=1,this.moveVector.y=0,this.moveVector.compareFunc=function(e,t){return t.position.horizontal-e.position.horizontal}):(this.moveVector.x=-1,this.moveVector.y=0,this.moveVector.compareFunc=function(e,t){return e.position.horizontal-t.position.horizontal}):i<o?(this.moveVector.x=0,this.moveVector.y=1,this.moveVector.compareFunc=function(e,t){return t.position.vertical-e.position.vertical}):(this.moveVector.x=0,this.moveVector.y=-1,this.moveVector.compareFunc=function(e,t){return e.position.vertical-t.position.vertical})},new v(o.DEFAULT_GAME_FIELD_SIZE).init()}]);