!function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);var i=0;function n(e,t){this.htmlElemnt,this.value=e,this.position={vertical:t.vertical,horizontal:t.horizontal},this.id=i,i+=1}n.prototype.move=function(e,t){this.position.horizontal+=t,this.position.vertical+=e},n.prototype.setValue=function(e){this.value=e};var r=n;function l(e){this.htmlElemnt=document.getElementById("playfield"),this.size=e,this.elements=[]}l.prototype.refresh=function(){for(var e="",t=this.htmlElemnt.getElementsByClassName("thing");t[0];)t[0].parentNode.removeChild(t[0]);this.elements.forEach(function(t){e+='<div class="thing t'+t.value+'" style="top: '+t.position.vertical+"px; left: "+t.position.horizontal+'px;"></div>'}),console.log(e),this.htmlElemnt.innerHTML+=e},l.prototype.insertElement=function(e){this.elements.push(e)},l.prototype.getRandomFreeCell=function(){for(var e=[],t=0;t<this.size;t++)for(var o=0;o<this.size;o++){var i={vertical:100*t,horizontal:100*o};this.isCellFree(i)&&e.push(i)}var n=parseInt(10*Math.random()%e.length);return console.log(e),console.log(n),e[n]},l.prototype.isFreeCells=function(){return this.elements.length!==Math.pow(this.size,2)},l.prototype.addElement=function(){this.isFreeCells()&&(Math.random()<.9?this.insertElement(new r(2,this.getRandomFreeCell())):this.insertElement(new r(4,this.getRandomFreeCell())),this.refresh())},l.prototype.isCellFree=function(e){var t=!0;return this.getElementByPosition(e)&&(t=!1),t},l.prototype.getElementByPosition=function(e){return this.elements.find(function(t){return!t.merged&&t.position.vertical==e.vertical&&t.position.horizontal==e.horizontal})};var s=l;function a(e){this.field=new s(e),this.moveVector={x:0,y:0}}a.prototype.validatePosition=function(e){var t={vertical:0,horizontal:0};return e.vertical>300?t.vertical=300:e.vertical<0?t.vertical=0:t.vertical=e.vertical,e.horizontal>300?t.horizontal=300:e.horizontal<0?t.horizontal=0:t.horizontal=e.horizontal,t},a.prototype.moveElements=function(){var e,t=this,o=0,i=0,n=0;-1==t.moveVector.y&&(o-=100,e=function(e,t){return-1*(t.position.vertical-e.position.vertical)}),1==t.moveVector.y&&(o+=100,e=function(e,t){return-1*(e.position.vertical-t.position.vertical)}),-1==t.moveVector.x&&(i-=100,e=function(e,t){return-1*(t.position.horizontal-e.position.horizontal)}),1==t.moveVector.x&&(i+=100,e=function(e,t){return-1*(e.position.horizontal-t.position.horizontal)}),t.field.elements.sort(e),console.log(t.field.elements),t.field.elements.forEach(function(e,r,l){var s={vertical:e.position.vertical+o,horizontal:e.position.horizontal+i};for(console.log("Двигаем элемент на позиции"),console.log(e.position);t.field.isCellFree(t.validatePosition(s));)console.log("Двигаем элемент на позицию"),console.log(s),e.move(o,i),n+=1,console.log("Теперь элемент на позиции"),console.log(e.position),s.vertical+=o,s.horizontal+=i;if(!t.field.isCellFree(s)){var a=t.field.getElementByPosition(s);e.value==a.value&&e.id!=a.id&&(a.setValue(2*e.value),l[r].merged=!0,n+=1)}}),t.field.elements=t.field.elements.filter(function(e){return!e.merged}),0!==n?t.field.addElement():this.field.isFreeCells()||alert("Game Over!")},a.prototype.init=function(){var e=this,t=0,o=0,i=0,n=0;window.onmousedown=function(e){t=e.clientX,o=e.clientY},window.onmouseup=function(r){i=r.clientX,n=r.clientY,(Math.abs(t-i)>50||Math.abs(o-n)>50)&&(e.getMoveVector(t,i,o,n),e.moveElements())},e.field.addElement()},a.prototype.getMoveVector=function(e,t,o,i){Math.abs(t-e)>Math.abs(i-o)?e<t?(this.moveVector.x=1,this.moveVector.y=0):(this.moveVector.x=-1,this.moveVector.y=0):o<i?(this.moveVector.x=0,this.moveVector.y=1):(this.moveVector.x=0,this.moveVector.y=-1)};new a(4).init()}]);